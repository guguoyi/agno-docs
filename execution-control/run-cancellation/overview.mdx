---
title: Cancelling a Run
sidebarTitle: Overview
description: Learn how to cancel an Agent run.
---

You can cancel a running agent, team or workflow by using the `cancel_run()` function.

Calling this function will mark the run for cancellation and the run will stop once the current step in the execution is completed. 

- Non-Streaming: The `RunOutput` object will be returned with the status set to `RunStatus.cancelled`.
- Streaming: A `RunCancelledEvent` will be emitted.

## Example
Below are examples of how to cancel a run directly in code.

<Tabs>
  <Tab title="Agent Cancellation">
    Below is a basic example that starts an agent run in a thread and cancels it from another thread, simulating how it can be done via an API. This is supported via [AgentOS](/agent-os/api#cancelling-a-run) as well.

    ```python
    import threading
    import time

    from agno.agent import Agent
    from agno.models.openai import OpenAIChat
    from agno.run.agent import RunEvent
    from agno.run.base import RunStatus


    def long_running_task(agent: Agent, run_id_container: dict):
        """
        Simulate a long-running agent task that can be cancelled.
        """
        # Start the agent run - this simulates a long task
        final_response = None
        content_pieces = []

        for chunk in agent.run(
            "Write a very long story about a dragon who learns to code. "
            "Make it at least 2000 words with detailed descriptions and dialogue. "
            "Take your time and be very thorough.",
            stream=True,
        ):
            if "run_id" not in run_id_container and chunk.run_id:
                run_id_container["run_id"] = chunk.run_id

            if chunk.event == RunEvent.run_content:
                print(chunk.content, end="", flush=True)
                content_pieces.append(chunk.content)
            # When the run is cancelled, a `RunEvent.run_cancelled` event is emitted
            elif chunk.event == RunEvent.run_cancelled:
                print(f"\nüö´ Run was cancelled: {chunk.run_id}")
                run_id_container["result"] = {
                    "status": "cancelled",
                    "run_id": chunk.run_id,
                    "cancelled": True,
                    "content": "".join(content_pieces)[:200] + "..."
                    if content_pieces
                    else "No content before cancellation",
                }
                return
            elif hasattr(chunk, "status") and chunk.status == RunStatus.completed:
                final_response = chunk

        # If we get here, the run completed successfully
        if final_response:
            run_id_container["result"] = {
                "status": final_response.status.value
                if final_response.status
                else "completed",
                "run_id": final_response.run_id,
                "cancelled": final_response.status == RunStatus.cancelled,
                "content": ("".join(content_pieces)[:200] + "...")
                if content_pieces
                else "No content",
            }
        else:
            run_id_container["result"] = {
                "status": "unknown",
                "run_id": run_id_container.get("run_id"),
                "cancelled": False,
                "content": ("".join(content_pieces)[:200] + "...")
                if content_pieces
                else "No content",
            }



    def cancel_after_delay(agent: Agent, run_id_container: dict, delay_seconds: int = 3):
        """
        Cancel the agent run after a specified delay.
        """
        print(f"‚è∞ Will cancel run in {delay_seconds} seconds...")
        time.sleep(delay_seconds)

        run_id = run_id_container.get("run_id")
        if run_id:
            print(f"üö´ Cancelling run: {run_id}")
            success = agent.cancel_run(run_id)
            if success:
                print(f"‚úÖ Run {run_id} marked for cancellation")
            else:
                print(
                    f"‚ùå Failed to cancel run {run_id} (may not exist or already completed)"
                )
        else:
            print("‚ö†Ô∏è  No run_id found to cancel")


    def main():
        # Initialize the agent with a model
        agent = Agent(
            name="StorytellerAgent",
            model=OpenAIChat(id="gpt-5-mini"),  # Use a model that can generate long responses
            description="An agent that writes detailed stories",
        )

        print("üöÄ Starting agent run cancellation example...")
        print("=" * 50)

        # Container to share run_id between threads
        run_id_container = {}

        # Start the agent run in a separate thread
        agent_thread = threading.Thread(
            target=lambda: long_running_task(agent, run_id_container), name="AgentRunThread"
        )

        # Start the cancellation thread
        cancel_thread = threading.Thread(
            target=cancel_after_delay,
            args=(agent, run_id_container, 8),  # Cancel after 5 seconds
            name="CancelThread",
        )

        # Start both threads
        print("üèÉ Starting agent run thread...")
        agent_thread.start()

        print("üèÉ Starting cancellation thread...")
        cancel_thread.start()

        # Wait for both threads to complete
        print("‚åõ Waiting for threads to complete...")
        agent_thread.join()
        cancel_thread.join()

        # Print the results
        print("\n" + "=" * 50)
        print("üìä RESULTS:")
        print("=" * 50)

        result = run_id_container.get("result")
        if result:
            print(f"Status: {result['status']}")
            print(f"Run ID: {result['run_id']}")
            print(f"Was Cancelled: {result['cancelled']}")

            if result.get("error"):
                print(f"Error: {result['error']}")
            else:
                print(f"Content Preview: {result['content']}")

            if result["cancelled"]:
                print("\n‚úÖ SUCCESS: Run was successfully cancelled!")
            else:
                print("\n‚ö†Ô∏è  WARNING: Run completed before cancellation")
        else:
            print("‚ùå No result obtained - check if cancellation happened during streaming")

        print("\nüèÅ Example completed!")


    if __name__ == "__main__":
        # Run the main example
        main()
    ```

    For a more complete example, see [Cancel a run](https://github.com/agno-agi/agno/tree/main/cookbook/agents/other/cancel_a_run.py).
  </Tab>
  <Tab title="Team Cancellation">
    Below is a basic example that starts a team run in a thread and cancels it from another thread, simulating how it can be done via an API.
    
    ```python
    import threading
    import time

    from agno.agent import Agent
    from agno.models.openai import OpenAIChat
    from agno.run.agent import RunEvent
    from agno.run.base import RunStatus
    from agno.run.team import TeamRunEvent
    from agno.team import Team


    def long_running_task(team: Team, run_id_container: dict):
        """
        Simulate a long-running team task that can be cancelled.
        """
        try:
            # Start the team run - this simulates a long task
            final_response = None
            content_pieces = []

            for chunk in team.run(
                "Write a very long story about a dragon who learns to code. "
                "Make it at least 2000 words with detailed descriptions and dialogue. "
                "Take your time and be very thorough.",
                stream=True,
            ):
                if "run_id" not in run_id_container and chunk.run_id:
                    print(f"üöÄ Team run started: {chunk.run_id}")
                    run_id_container["run_id"] = chunk.run_id

                if chunk.event in [TeamRunEvent.run_content, RunEvent.run_content]:
                    print(chunk.content, end="", flush=True)
                    content_pieces.append(chunk.content)
                elif chunk.event == RunEvent.run_cancelled:
                    print(f"\nüö´ Member run was cancelled: {chunk.run_id}")
                    run_id_container["result"] = {
                        "status": "cancelled",
                        "run_id": chunk.run_id,
                        "cancelled": True,
                        "content": "".join(content_pieces)[:200] + "..."
                        if content_pieces
                        else "No content before cancellation",
                    }
                    return
                elif chunk.event == TeamRunEvent.run_cancelled:
                    print(f"\nüö´ Team run was cancelled: {chunk.run_id}")
                    run_id_container["result"] = {
                        "status": "cancelled",
                        "run_id": chunk.run_id,
                        "cancelled": True,
                        "content": "".join(content_pieces)[:200] + "..."
                        if content_pieces
                        else "No content before cancellation",
                    }
                    return
                elif hasattr(chunk, "status") and chunk.status == RunStatus.completed:
                    final_response = chunk

            # If we get here, the run completed successfully
            if final_response:
                run_id_container["result"] = {
                    "status": final_response.status.value
                    if final_response.status
                    else "completed",
                    "run_id": final_response.run_id,
                    "cancelled": final_response.status == RunStatus.cancelled,
                    "content": ("".join(content_pieces)[:200] + "...")
                    if content_pieces
                    else "No content",
                }
            else:
                run_id_container["result"] = {
                    "status": "unknown",
                    "run_id": run_id_container.get("run_id"),
                    "cancelled": False,
                    "content": ("".join(content_pieces)[:200] + "...")
                    if content_pieces
                    else "No content",
                }

        except Exception as e:
            print(f"\n‚ùå Exception in run: {str(e)}")
            run_id_container["result"] = {
                "status": "error",
                "error": str(e),
                "run_id": run_id_container.get("run_id"),
                "cancelled": True,
                "content": "Error occurred",
            }


    def cancel_after_delay(team: Team, run_id_container: dict, delay_seconds: int = 3):
        """
        Cancel the team run after a specified delay.
        """
        print(f"‚è∞ Will cancel team run in {delay_seconds} seconds...")
        time.sleep(delay_seconds)

        run_id = run_id_container.get("run_id")
        if run_id:
            print(f"üö´ Cancelling team run: {run_id}")
            success = team.cancel_run(run_id)
            if success:
                print(f"‚úÖ Team run {run_id} marked for cancellation")
            else:
                print(
                    f"‚ùå Failed to cancel team run {run_id} (may not exist or already completed)"
                )
        else:
            print("‚ö†Ô∏è  No run_id found to cancel")


    def main():
        """Main function demonstrating team run cancellation."""

        # Create team members
        storyteller_agent = Agent(
            name="StorytellerAgent",
            model=OpenAIChat(id="gpt-5-mini"),
            description="An agent that writes creative stories",
        )

        editor_agent = Agent(
            name="EditorAgent",
            model=OpenAIChat(id="gpt-5-mini"),
            description="An agent that reviews and improves stories",
        )

        # Initialize the team with agents
        team = Team(
            name="Storytelling Team",
            members=[storyteller_agent, editor_agent],
            model=OpenAIChat(id="gpt-5-mini"),  # Team leader model
            description="A team that collaborates to write detailed stories",
        )

        print("üöÄ Starting team run cancellation example...")
        print("=" * 50)

        # Container to share run_id between threads
        run_id_container = {}

        # Start the team run in a separate thread
        team_thread = threading.Thread(
            target=lambda: long_running_task(team, run_id_container), name="TeamRunThread"
        )

        # Start the cancellation thread
        cancel_thread = threading.Thread(
            target=cancel_after_delay,
            args=(team, run_id_container, 8),  # Cancel after 8 seconds
            name="CancelThread",
        )

        # Start both threads
        print("üèÉ Starting team run thread...")
        team_thread.start()

        print("üèÉ Starting cancellation thread...")
        cancel_thread.start()

        # Wait for both threads to complete
        print("‚åõ Waiting for threads to complete...")
        team_thread.join()
        cancel_thread.join()

        # Print the results
        print("\n" + "=" * 50)
        print("üìä RESULTS:")
        print("=" * 50)

        result = run_id_container.get("result")
        if result:
            print(f"Status: {result['status']}")
            print(f"Run ID: {result['run_id']}")
            print(f"Was Cancelled: {result['cancelled']}")

            if result.get("error"):
                print(f"Error: {result['error']}")
            else:
                print(f"Content Preview: {result['content']}")

            if result["cancelled"]:
                print("\n‚úÖ SUCCESS: Team run was successfully cancelled!")
            else:
                print("\n‚ö†Ô∏è  WARNING: Team run completed before cancellation")
        else:
            print("‚ùå No result obtained - check if cancellation happened during streaming")

        print("\nüèÅ Team cancellation example completed!")


    if __name__ == "__main__":
        # Run the main example
        main()
    ```

    For a more complete example, see [Cancel a run](https://github.com/agno-agi/agno/tree/main/cookbook/teams/basic/team_cancel_a_run.py).
  </Tab>
  <Tab title="Workflow Cancellation">
    Below is a basic example that starts a workflow in a background thread and cancels it from another thread, simulating how it can be done via an API.

    ```python
    import asyncio
    from agno.workflow import Workflow
    from agno.agent import Agent
    from agno.models.openai import OpenAIChat
    from agno.workflow.step import Step

    # Setup workflow
    long_running_workflow = Workflow(
        name="Long Running Analysis",
        steps=[
            Step(name="Research", agent=Agent(model=OpenAIChat(id="gpt-5-mini"), instructions="You are a helpful assistant that can research the web.")),
            Step(name="Deep Analysis", agent=Agent(model=OpenAIChat(id="gpt-5-mini"), instructions="You are a helpful assistant that can analyze the web.")),
            Step(name="Report Generation", agent=Agent(model=OpenAIChat(id="gpt-5-mini"), instructions="You are a helpful assistant that can generate a report.")),
        ]
    )

    async def main():
        # Start background workflow
        bg_response = await long_running_workflow.arun(
            input="Comprehensive market analysis for emerging technologies",
            background=True
        )
        
        print(f"Started workflow with run_id: {bg_response.run_id}")
        
        # Simulate some time passing
        await asyncio.sleep(5)
        
        # Cancel the workflow
        cancellation_result = long_running_workflow.cancel_run(bg_response.run_id)
        
        if cancellation_result:  # cancellation_result is a bool
            print(f"‚úÖ Workflow {bg_response.run_id} cancelled successfully")
        else:
            print(f"‚ùå Failed to cancel workflow {bg_response.run_id}")

    asyncio.run(main())
    ```

    For a more complete example, see [Workflow Cancellation](/examples/basics/workflows/06_workflows_advanced_basics/workflow_cancellation).
  </Tab>
</Tabs>

## Cancelling a Run from the AgentOS API

You can cancel a running agent, team or workflow by using the appropriate endpoint.

For example, to cancel an agent run:

```bash
curl --location 'http://localhost:7777/agents/story-writer-agent/runs/123/cancel'
```

See more in the [AgentOS API](/agent-os/api#cancelling-a-run) documentation.

